<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Final Verification Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f1218;
      --panel: #1c212b;
      --panel2: #232a36;
      --accent: #78b4ff;
      --good: #46d282;
      --bad: #ef5c5c;
      --text: #edf0f4;
      --muted: #9ca4b0;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #18202e 0%, #0f1218 55%, #0b0d11 100%);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 1rem;
    }
    .app {
      background: rgba(12,14,18,0.45);
      border: 1px solid rgba(120,180,255,0.12);
      backdrop-filter: blur(10px);
      border-radius: 18px;
      padding: 1.4rem 1.4rem 1.1rem;
      width: min(980px, 100%);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    header h1 {
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin: 0;
    }
    .status-chip {
      background: rgba(120,180,255,0.12);
      border: 1px solid rgba(120,180,255,0.4);
      border-radius: 999px;
      padding: 0.3rem 0.9rem;
      font-size: 0.7rem;
    }
    p.desc {
      margin: 0 0 1rem 0;
      color: var(--muted);
      font-size: 0.88rem;
    }
    .grid {
      display: grid;
      gap: 0.85rem;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }
    @media (max-width: 850px) {
      .grid { grid-template-columns: 1fr; }
      header { flex-direction: column; align-items: flex-start; }
    }
    .field {
      background: rgba(28,33,44,0.5);
      border: 1px solid rgba(255,255,255,0.02);
      border-radius: 14px;
      padding: 0.7rem 0.7rem 0.75rem;
    }
    .field label {
      font-size: 0.68rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--muted);
      display: block;
      margin-bottom: 0.35rem;
    }
    .field input {
      width: 100%;
      background: rgba(4,5,7,0.48);
      border: 1px solid rgba(255,255,255,0.03);
      border-radius: 10px;
      padding: 0.55rem 0.65rem;
      color: var(--text);
      font-size: 0.85rem;
      outline: none;
    }
    .hint {
      margin-top: 0.4rem;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(120,180,255,0.08);
      border-radius: 8px;
      padding: 0.38rem 0.5rem 0.45rem;
      font-size: 0.62rem;
      line-height: 1.3;
      color: rgba(237,240,244,0.72);
    }
    .hint strong { color: #fff; }

    button#submitBtn {
      margin-top: 1.1rem;
      background: linear-gradient(135deg, #78b4ff 0%, #4eb5ff 100%);
      border: none;
      color: #03050a;
      font-weight: 600;
      border-radius: 12px;
      padding: 0.65rem 1.4rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: transform 0.1s ease;
    }
    button#submitBtn:active { transform: scale(0.99); }
    #result {
      margin-top: 1rem;
      padding: 0.6rem 0.85rem;
      border-radius: 12px;
      background: rgba(3,4,6,0.35);
      border: 1px solid transparent;
      font-size: 0.88rem;
      white-space: normal;
    }
    #result.ok { border-color: rgba(70,210,130,0.4); background: rgba(70,210,130,0.05); }
    #result.err { border-color: rgba(235,92,92,0.4); background: rgba(235,92,92,0.03); }
    .wrong-list {
      margin-top: 0.4rem;
      font-size: 0.73rem;
      color: rgba(237,240,244,0.7);
    }

    .modern-code {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin: 0.25rem 0 0.4rem 0;
    }
    .code-label {
      font-size: 0.68rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }
    .code-pill {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 8px;
      background: rgba(4,5,7,0.5);
      border: 1px solid rgba(255,255,255,0.08);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
      font-size: 0.8rem;
      user-select: all;
    }
    .inline-btn {
      display: inline-block;
      margin-top: 0.4rem;
      background: rgba(120,180,255,0.12);
      border: 1px solid rgba(120,180,255,0.35);
      border-radius: 6px;
      padding: 0.25rem 0.5rem;
      font-size: 0.62rem;
      color: #fff;
      cursor: pointer;
    }
    .step-output {
      margin-top: 0.3rem;
      font-size: 0.6rem;
      background: rgba(0,0,0,0.15);
      border: 1px solid rgba(255,255,255,0.02);
      border-radius: 6px;
      padding: 0.3rem 0.4rem;
      line-height: 1.35;
      word-break: break-word;
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Final Verification Panel</h1>
      <div class="status-chip">AI Escape Room · Final Gate</div>
    </header>
    <p class="desc">
      Enter the <strong>decoded</strong> keys from each station. Each station used a different cipher — the hint under each box points to the method of encryption. Keep punctuation and capitalize everything.
    </p>

    <div class="grid">
      <!-- Station 1 — Caesar -->
      <div class="field">
        <label for="s1">Code 1: </label>
        <input id="s1" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> A Roman General once said his letters should <em>march three steps backwards</em>.
        </div>
      </div>

      <!-- Station 2 — Pigpen -->
      <div class="field">
        <label for="s2">Code 2: </label>
        <input id="s2" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> Symbol/grid substitution used by lodges. Boxes, corners, X-shapes; dots mark the variant.
        </div>
      </div>

      <!-- Station 3 — Playfair -->
      <div class="field">
        <label for="s3">Code 3: </label>
        <input id="s3" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> 5×5 digraph cipher built from a keyword (I/J share a cell).
        </div>
      </div>

      <!-- Station 4 — Beale -->
      <div class="field">
        <label for="s4">Code 4: </label>
        <input id="s4" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> The key lies in plain text — each number reveals its letter by counting words in the “research notes.”
        </div>
      </div>

      <!-- Station 5 — Enigma -->
      <div class="field">
        <label for="s5">Code 5: </label>
        <input id="s5" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> The signal passed through an antique cipher core. Reconstruct its logic gates:
          <br>Enigma I — Reflector B — Rotors I(4D), II(1A), III(16P) — Rings AAA  
          <br>Patch the plugboard as bq cr di ej kw mt os px uz gh.  
          When power flows, the machine will whisper the scientist’s name.
        </div>
      </div>

      <!-- Station 6 — Modern (Base64 + XOR) -->
      <div class="field">
        <label for="s6">Code 6: </label>

        <div class="modern-code">
          <div class="code-label">Code:</div>
          <code class="code-pill" id="modernCipher">EA0PAA0WDmYdFRcAGQAefg==</code>
        </div>

        <input id="s6" autocomplete="off" placeholder="enter decoded key…" />
        <div class="hint">
          <strong>Hint:</strong> 1) Decode from Base64. 2) XOR the decoded bytes with
          <code>STATE_OF_GRACE_2025</code>. You’ll get the name of an MIT roboticist.
          <div class="inline-btn" onclick="showXorSteps()">How do I do XOR?</div>
          <div id="stepOutput" class="step-output" style="display:none;"></div>
        </div>
      </div>
    </div>

    <!-- submit + result -->
    <button id="submitBtn">Submit Codes</button>
    <div id="result"></div>
  </div>

  <script>
    // ---- SHA-256 helper ----
    async function sha256Hex(message) {
      const enc = new TextEncoder();
      const data = enc.encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
    }

    // expected hashes
    const STATION_HASHES = [
      "fb977a7ddd4dc338c9a8f531b10673ca7dfe6f25e00ada29a88a3de3b02b9c35", // s1 PARISA TABRIZ
      "84251a2e80c41e24e77d114823276d7a923bbed234a8531370d0b36fff8332a3", // s2 FEI-FEI LI
      "97a7d1e37677d9df763a61121a5f1d1286b544c474311f7492da666fa9e54b8a", // s3 TIMNIT GEBRU
      "00c5f92bd72ca1221c715a03d7c5e9b693b763eb67328f2385a34e6a8821d1c0", // s4 JOY BUOLAMWINI
      "8962d8f97c11195aae052d93de6ddbd80c548a9394e80e4dba4b8606cdec1b82", // s5 DAPHNE KOLLER
      "dd3c9ac01b31e2ebff85710392bb4c79f262270ec384c9dffaed7f7122f9cd4a"  // s6 CYNTHIA BREAZEAL
    ];

    // base64 → bytes
    function b64ToBytes(b64) {
      const bin = atob(b64);
      const arr = new Uint8Array(bin.length);
      for (let i = 0; i < bin.length; i++) {
        arr[i] = bin.charCodeAt(i);
      }
      return arr;
    }

    // this is called by onclick in the HTML
    function showXorSteps() {
      const cipherEl = document.getElementById("modernCipher");
      const stepOutput = document.getElementById("stepOutput");
      if (!cipherEl || !stepOutput) return;

      const b64 = cipherEl.textContent.trim();
      const decodedLen = b64ToBytes(b64).length;
      const key = "STATE_OF_GRACE_2025";

      stepOutput.style.display = "block";
      stepOutput.innerHTML =
        "<strong>Step 1:</strong> Go to an online Base64 decoder and paste <code>" + b64 + "</code>." +
        "<br>This will give you " + decodedLen + " scrambled characters (not the final name)." +
        "<br><strong>Step 2:</strong> XOR those characters with the passphrase <code>" + key + "</code>." +
        "<br>Line them up: first decoded char ⟷ 'S', second ⟷ 'T', third ⟷ 'A', keep going, and when you reach the end of the passphrase, start again at 'S'." +
        "<br><strong>Step 3:</strong> After XOR, you will see a normal name. Type that in the box.";
    }

    // submit handler
    document.getElementById("submitBtn").addEventListener("click", async () => {
      const result = document.getElementById("result");
      const vals = [
        document.getElementById("s1").value,
        document.getElementById("s2").value,
        document.getElementById("s3").value,
        document.getElementById("s4").value,
        document.getElementById("s5").value,
        document.getElementById("s6").value,
      ];

      const wrong = [];
      for (let i = 0; i < vals.length; i++) {
        const userHash = await sha256Hex(vals[i]);
        if (userHash !== STATION_HASHES[i]) wrong.push(i + 1);
      }

      if (wrong.length === 0) {
        result.className = "ok";
        result.innerHTML = `
          ✅ <strong>Access Granted.</strong><br>
          <strong>Congratulations!</strong> You found all the famous women in AI and cybersecurity the AI was trying to hide.
          <br><br>
          <em>Recovered identities:</em>
          <ul style="margin:0.45rem 0 0 1.1rem; padding:0; font-size:0.78rem;">
            <li>PARISA TABRIZ</li>
            <li>FEI-FEI LI</li>
            <li>TIMNIT GEBRU</li>
            <li>JOY BUOLAMWINI</li>
            <li>DAPHNE KOLLER</li>
            <li>CYNTHIA BREAZEAL</li>
          </ul>
          <br>
          Master Code: <strong>***UNLOCKED***</strong>
        `;
      } else {
        result.className = "err";
        result.textContent = "⛔ One or more codes are incorrect.";
        const div = document.createElement("div");
        div.className = "wrong-list";
        div.textContent = "Check Stations: " + wrong.join(", ");
        result.appendChild(div);
      }
    });
  </script>
</body>
</html>
